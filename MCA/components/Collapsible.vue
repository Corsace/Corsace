<template>
    <div 
        class="collapsible"
        :class="{ 'collapsible--scrollable': scroll }"
    >
        <div
            class="collapsible__title"
            :class="{ 'collapsible__title--active': active }"
            @click="activate"
        >
            {{ title }}
        </div>
        <hr 
            class="collapsible__bar"
            :class="`collapsible--${selectedMode}`"
        >

        <transition name="fade">
            <div
                v-if="active"
                class="collapsible__items"
                :class="{ 'collapsible__items-extra': !showExtra }"
            >
                <div
                    v-for="(item, i) in list"
                    :key="i"
                    class="collapsible__info"
                    @click="setTarget(item)"
                >
                    <div 
                        class="collapsible__name"
                        :class="{'collapsible__name--active': showExtra && target===item}"
                    >
                        {{ item.name }} {{ showExtra ? item.maxNominations && !('count' in item) ? "- " + item.maxNominations: "" : "" }}
                    </div>
                    <hr
                        class="collapsible__info-bar"
                        :class="[
                            {'collapsible__info-bar--active': showExtra && target===item}, 
                            `collapsible--${selectedMode}`
                        ]"
                    >

                    <template v-if="showExtra">
                        <div
                            v-if="'count' in item && 'maxNominations' in item"
                            class="collapsible__count"
                            :class="{'collapsible__count--active': target===item}"
                        >
                            {{ item.count }}/{{ item.maxNominations }}
                        </div>
                        <div
                            v-else-if="'type' in item"
                            class="collapsible__count"
                            :class="{'collapsible__count--active': target===item}"
                        >
                            {{ item.type }}
                        </div>
                    </template>
                </div>
            </div>
        </transition>
    </div>
</template>

<script lang="ts">
import { Vue, Component, Prop } from "vue-property-decorator";
import { State } from "vuex-class";

interface SubItem {
    name: string;
    count?: number;
    total?: number;
    type?: string;
    mode?: string;
    [key: string]: any;
}

@Component
export default class Collapsible extends Vue {
    
    @Prop({ type: String, default: "" }) readonly title!: string;
    @Prop({ type: Array, default: () => [] }) readonly list!: SubItem[];
    @Prop(Boolean) readonly active!: boolean[];
    @Prop(Boolean) readonly showExtra!: boolean[];
    @Prop(Boolean) readonly scroll!: boolean[];

    @State selectedMode!: string;

    target: SubItem | null = null;
    
    mounted () {
        if (this.list.length > 0 && this.active && !this.target) {
            this.target = this.list[0];
            this.$emit("target", this.target);
        }
    }

    activate () {
        if (this.active) return;

        this.$emit("activate");
        this.target = null;
    }

    setTarget (item: SubItem) {
        this.$emit("target", item);

        if (this.target !== item) {
            this.target = item;
        }
    }
        
}
</script>

<style lang="scss">
@import '@s-sass/_mixins';
@import '@s-sass/_variables';
@import '@s-sass/_partials';

.collapsible {
    @extend %flex-box;
    flex-direction: column;
    color: $gray;
    white-space: nowrap;
    overflow: hidden;
    padding: 15px;

    @include transition;

    &--scrollable {
        overflow-y: visible;
    }

    &__title {
        white-space: normal;
        letter-spacing: -3px;
        font-family: $font-display;
        text-align: center;
        font-size: $font-xxl;
        cursor: pointer;

        &--active {
            cursor: default;
            color: white;
            text-shadow: 0 0 8px white;
        }
    }

    @include mode-border;
}

.collapsible__bar {
    right: -25%;
    top: -2px;
    position: relative;
    margin: 0;

    @include transition;
}

.collapsible__items {
    margin-top: 15px;
    position: relative;
    
    &-extra {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
}

.collapsible__info {
    position: relative;
    display: flex;
    align-items: center;
    font-size: $font-lg;

    &-bar {
        left: 1%;
        right: 0;
        bottom: 0;

        width: 0;
        border-width: 0;
        margin: 0;
        position: absolute;

        @include transition;

        &--active {
            width: 60%;
            border-width: 1px;
        }
    }
}

.collapsible__name {
    cursor: pointer;
    @include transition;

    &:hover, &--active {
        text-shadow: 0 0 8px white;
        font-weight: 500;
    }
}

.collapsible__count {
    width: 14%;
    min-width: fit-content;
    color: white;
    border: 1px solid white;
    border-radius: 7px;

    padding: 5px 9px;
    margin-left: auto;

    letter-spacing: 2px;
    cursor: default;
    @include transition;

    &--active {
        background-color: white;
        color: rgba(0, 0, 0, 0.6);
        box-shadow: 0 0 10px white;
    }
}

.collapsible__scroll {
    height: 350px;
    top: 16%;
}
</style>
